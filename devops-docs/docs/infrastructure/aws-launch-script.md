# AWS Default Launch Script

Script to automatically configure SSH access on new AWS instances.

## SSH Public Key Setup

This script adds a public key to the `authorized_keys` file for root user, creating the `.ssh` directory if needed.

### Full Script

```bash
#!/bin/bash

# SSH Public Key to Add
PUBLIC_KEY="ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGkLAa+RBKP8FpDKfMBmRjwx9kKkDGKNwHFZtZi0ozNk Generated By Termius"

# Target user and directory
USER="root"
SSH_DIR="/root/.ssh"
AUTHORIZED_KEYS="$SSH_DIR/authorized_keys"

# Create .ssh directory if it doesn't exist
if [ ! -d "$SSH_DIR" ]; then
  mkdir -p "$SSH_DIR"
  echo "Created $SSH_DIR directory."
fi

# Set proper permissions
chmod 700 "$SSH_DIR"

# Add the public key if it doesn't already exist
if grep -qF "$PUBLIC_KEY" "$AUTHORIZED_KEYS" 2>/dev/null; then
  echo "Public key already exists in $AUTHORIZED_KEYS."
else
  echo "$PUBLIC_KEY" >> "$AUTHORIZED_KEYS"
  echo "Public key added to $AUTHORIZED_KEYS."
fi

# Set permissions for authorized_keys
chmod 600 "$AUTHORIZED_KEYS"
chown "$USER":"$USER" "$AUTHORIZED_KEYS"

echo "✅ SSH public key added successfully."
```

## Usage

### As User Data (EC2 Launch)

1. Open EC2 console → Launch Instance
2. Under **Advanced details** → **User data**, paste the script
3. Launch instance; script runs automatically on first boot

### Manual Execution

```bash
# Save to file
nano setup-ssh.sh

# Paste script, save (CTRL+X, Y, ENTER)

# Make executable
chmod +x setup-ssh.sh

# Run as root
sudo ./setup-ssh.sh
```

## Security Notes

- Replace `PUBLIC_KEY` with your actual public key
- For non-root users, change `USER` and `SSH_DIR` variables
- Script is idempotent (safe to run multiple times)
- Permissions set correctly: 700 for `.ssh`, 600 for `authorized_keys`

## Customization

To add multiple keys:

```bash
PUBLIC_KEYS=(
  "ssh-ed25519 AAAA... user1@host"
  "ssh-rsa AAAA... user2@host"
)

for KEY in "${PUBLIC_KEYS[@]}"; do
  if ! grep -qF "$KEY" "$AUTHORIZED_KEYS" 2>/dev/null; then
    echo "$KEY" >> "$AUTHORIZED_KEYS"
  fi
done
```

## Verification

After running, test SSH access:

```bash
ssh -i /path/to/private_key root@<instance-ip>
```

Check authorized keys on the instance:

```bash
cat /root/.ssh/authorized_keys
ls -la /root/.ssh/
```
